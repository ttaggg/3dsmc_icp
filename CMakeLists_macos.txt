cmake_minimum_required(VERSION 3.6)

set(CMAKE_CONFIGURATION_TYPES Debug Release CACHE TYPE INTERNAL FORCE)

project(3dsmc_icp)

# Options
set(LIBRARY_DIR ${CMAKE_CURRENT_SOURCE_DIR}/../Libs CACHE PATH "Path to lib folder")
set(Eigen3_DIR ${LIBRARY_DIR}/Eigen/share/eigen3/cmake CACHE PATH "Path to installed Eigen")
set(glog_DIR ${LIBRARY_DIR}/glog-lib/lib/cmake/glog CACHE PATH "Path to installed glog")
set(Ceres_DIR ${LIBRARY_DIR}/Ceres/CMake CACHE PATH "Path to installed Ceres")

set(Flann_INCLUDE_DIR /opt/homebrew/Cellar/flann/1.9.2_1)
include_directories(${Flann_INCLUDE_DIR}/include/)
link_directories(${Flann_INCLUDE_DIR}/lib/)

set(FREE_IMAGE_DIR /opt/homebrew/Cellar/freeimage/3.18.0)  
include_directories(${FREE_IMAGE_DIR}/include/)
link_directories(${FREE_IMAGE_DIR}/lib/)

set(LZ4_DIR /opt/homebrew/Cellar/lz4/1.9.4)  
include_directories(${LZ4_DIR}/include/)
link_directories(${LZ4_DIR}/lib/)

#find_library(LZ4_LIBRARY lz4)
#target_link_libraries(3dsmc_icp PRIVATE ${LZ4_LIBRARY})

# Set C++ flags
set(CMAKE_CXX_STANDARD 14)

#find_package(nanoflann REQUIRED)
find_package(Ceres REQUIRED)
find_package(glog REQUIRED)
get_target_property(GLOG_DLL_PATH_DEBUG glog::glog IMPORTED_LOCATION_DEBUG)
get_target_property(GLOG_DLL_PATH_RELEASE glog::glog IMPORTED_LOCATION_RELEASE)

add_definitions("-D_DISABLE_EXTENDED_ALIGNED_STORAGE")

include_directories(include)
include_directories(external/data_utils)

set(HEADER_FILES 
    external/data_utils/Eigen.h 
    external/data_utils/SimpleMesh.h 
    external/data_utils/PointCloud.h 
    external/data_utils/VirtualSensor.h 
    include/NearestNeighbor.h 
    include/ProcrustesAligner.h 
    include/ICPOptimizer.h 
    external/data_utils/FreeImageHelper.h
)

set(SOURCE_FILES 
    external/data_utils/FreeImageHelper.cpp
    src/NearestNeighbor.cpp
    src/ProcrustesAligner.cpp
    src/ICPOptimizer.cpp
)

add_executable(3dsmc_icp src/main.cpp ${HEADER_FILES} ${SOURCE_FILES})
target_link_libraries(3dsmc_icp ceres freeimage flann Eigen3::Eigen lz4)
target_include_directories(3dsmc_icp PUBLIC ${EIGEN3_INCLUDE_DIR} ${FreeImage_INCLUDE_DIR} ${Flann_INCLUDE_DIR} ${LZ4_DIR})
